---
name: bug-fix
description: 当用户提出了某个异常或者bug并要求进行修复时 务必先阅读该份指南
allowed-tools: mcp__code-RAG__*
---

# BUG修复

## 基本流程
1. Bug修复前
   检查项目根目录中的`.claude/fix/List.md`是否存在
   - 如果不存在则新建一个
   - 如果存在则阅读内容
2. Bug修复时
   每次执行完一个对话后运行index_codebase更新索引 但不要运行add_knowledge 而是将修复方案详细记录到BUG_FIX.md
   - 如果用户不认可 则完全撤销这一条修改的代码 同时在排除列表记录这条无效的修复方案 从别的角度再尝试修复
   - 如果用户确认改动产生了影响但没有修复异常 则也不要记录add_knowledge 而是将其记录至有效列表 然后继续执行修复
   每次修复时 添加日志 并要求用户置入`PROJECT/.claude/fix/.log`
   一次修复结束后 用大写字母展示当次修复了的异常列表 并要求用户在接下来的一次对话中确认修复效果
3. 修复完成时
   如果用户认可了某条修复 执行以下步骤
   1. 将认可的Bug在List.md中标记为修复完成
   2. 在对应的bug文件夹中新建一个exp.md
   3. 将最终修复方案分为项目经验和全局经验 保存进exp.md
   4. 调用add_knowledge记录修复经验
   5. 如果这个bug与另外一个bug存在关联关系 将两者合并为一个bug 删除另外一个

## fix文件夹格式
```dir
PROJECT_ROOT/
- .claude/
  - fix/
    - List.md
    - bug1/
      - desc.md
      - 1.log
      - X.log
    - bugX/
      - desc.md
      - 1.log
      - X.log
```

## List.md文件格式
List.md只记录大概内容 以及任务状态 不记录实际的修复日志 详细内容请记录到各个bug自己的desc.md中
```Markdown
# BUG列表
1. Bug 1 @文件夹名
   对于这个bug的概括性描述
   - 已进行X轮修复
   - 当前状态[尚未开始修复/待用户确认/修复有效但不完全/修复完成]
2. Bug X @文件夹名
   对于这个bug的概括性描述
   - 已进行X轮修复
   - 当前状态
```

## desc.md文件格式
desc.md中记录详细的修改日志 修复记录等内容 需要尽可能详细 按照修复轮次记录每一轮都做了什么 用户有什么反馈等
```Markdown
# Bug1详细描述

## 用户描述 //详细记录用户对于这个bug的描述
1. 用户的第一次描述
2. 用户后续每次补充的描述单独加一条

## 修复日志
1. 第X轮修复
   - 这里描述做了什么样的修复
   涉及文件
   - 文件名
   用户反馈
   - 状态[修复成功/修复无效/部分有效(哪里有效)]
   经验总结
   - 这里记录通过这一轮修复认识到的事情

## 认知笔记
1. 可能与xxx有关
2. 什么改动是无效的 未来不要再在此方面进行修复
3. 调查代码时发现哪里存在非系统性设计或者非最佳实践 记录todo项 待后续优化
```

## exp.md文件格式
```Markdown
# 最终修复方案

## 项目修复 //这里的经验更精确一些 精确指出哪些模块出现了什么问题
//描述问题是怎么产生的
//描述问题产生的原因
//描述问题是如何修复的

## 全局经验 //这里的经验更泛泛一些 用于指导其他项目的CC不再犯同样的错误
//描述问题是怎么产生的
//描述问题产生的原因
//描述问题是如何修复的
```