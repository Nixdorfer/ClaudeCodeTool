---
name: bug-fix
description: 当用户提出了某个异常或者bug并要求进行修复时 务必先阅读该份指南
allowed-tools: mcp__code-RAG__*
---

# BUG修复

## 基本流程
1. Bug修复前
   检查项目根目录中的`.claude/fix/List.md`是否存在
   - 如果不存在则新建一个
   - 如果存在则阅读内容
2. Bug修复时
   每次执行完一个对话后运行index_codebase更新索引 但不要运行add_knowledge 而是将修复方案详细记录到BUG_FIX.md
   - 如果用户不认可 则完全撤销这一条修改的代码 同时在排除列表记录这条无效的修复方案 从别的角度再尝试修复
   - 如果用户确认改动产生了影响但没有修复异常 则也不要记录add_knowledge 而是将其记录至有效列表 然后继续执行修复
   每次修复时 添加日志 并要求用户置入`PROJECT/.claude/fix/.log`
   一次修复结束后 用大写字母展示当次修复了的异常列表 并要求用户在接下来的一次对话中确认修复效果
3. 修复完成时
   如果用户认可了某条修复 执行以下步骤
   1. 将认可的Bug在List.md中标记为修复完成
   2. 在对应的bug文件夹中新建一个exp.md
   3. 将最终修复方案分为项目经验和全局经验 保存进exp.md
   4. 调用add_knowledge记录修复经验

## fix文件夹格式
```dir
PROJECT_ROOT/
- .claude/
  - fix/
    - List.md
    - bug1/
      - desc.md
      - 1.log
      - X.log
    - bugX/
      - desc.md
      - 1.log
      - X.log
```

## List.md文件格式

```Markdown
# BUG列表
1. Bug 1 @文件夹名
   对于这个bug的概括性描述
   - 已进行X轮修复
   - 当前状态[尚未开始修复/修复有效但不完全/修复完成]
2. Bug X @文件夹名
   对于这个bug的概括性描述
   - 已进行X轮修复
   - 当前状态[尚未开始修复/修复有效但不完全/修复完成]
```

## desc.md文件格式
```Markdown
# Bug1详细描述

## 用户描述 //详细记录用户对于这个bug的描述
1. 用户的第一次描述
2. 用户后续每次补充的描述单独加一条

## 有效的改动
1. 对xxx进行修复
   //对于修复的详细描述
   改动代码
   - 文件名
   - xxx.rs
   关联的日志
   - x.log

## 无效的改动
1. 对xxx进行修复
   //对于修复的详细描述
   改动代码
   - 文件名
   - xxx.rs
   关联的日志
   - x.log

## 当前认知
1. Claude认为可能与xxx有关
2. 用户认为可能与xxx有关
3. 正在等待尝试xxx方案

## 关联列表 //处理这个bug时 同时需要读取这些bug
- Bug X
- Bug Y
```

## exp.md文件格式
```Markdown
# 最终修复方案

## 项目修复 //这里的经验更精确一些 精确指出哪些模块出现了什么问题
//描述问题是怎么产生的
//描述问题产生的原因
//描述问题是如何修复的

## 全局经验 //这里的经验更泛泛一些 用于指导其他项目的CC不再犯同样的错误
//描述问题是怎么产生的
//描述问题产生的原因
//描述问题是如何修复的
```